# ─────────────────────────────────────────────────────────────
# GitHub Action à placer dans le repo FRONTEND :
#   .github/workflows/deploy.yml
#
# Secrets GitHub requis dans le repo front :
#   GCP_SA_KEY : clé JSON du service account GCP
# ─────────────────────────────────────────────────────────────
name: Deploy Frontend

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: front/frontend
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-node@v4
        with:
          node-version: "20"
          cache: "npm"
          cache-dependency-path: front/frontend/package-lock.json

      - run: npm ci
      - run: npm run build

      - uses: google-github-actions/auth@v2
        with:
          credentials_json: ${{ secrets.GCP_SA_KEY }}

      - uses: google-github-actions/setup-gcloud@v2

      - name: Upload to GCS
        run: |
          gsutil -m rsync -r -d dist/ gs://app-toyboxing.th-fchs-fr/
